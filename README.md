# SlipSnap

SlipSnap — десктоп-приложение на PySide6 для быстрого захвата экрана, редактирования и экспорта в статические и анимированные форматы.

## Основные возможности

- Захват области или всего виртуального рабочего стола.
- Корректная работа на 1-3+ мониторах с разным DPI и разрешением.
- Лончер + режим в трее: при закрытии лончер уходит в трей, приложение продолжает работать.
- Редактор с undo/redo, слоями и drag-and-drop изображений.
- Вставка и редактирование анимированных GIF (в том числе из буфера и библиотеки мемов).
- Экспорт в PNG/JPG/GIF; при анимированном контенте сохранение по умолчанию в GIF.
- Видео-захват 5-10 секунд с экспортом в MP4 или GIF.
- Библиотека мемов с анимированными GIF-превью, удалением, переименованием и открытием папки.
- OCR-поток с выбором языков и вставкой распознанного текста на холст.

## Установка и запуск

### Требования

- Python 3.8+
- PySide6
- FFmpeg (для видео и конвертации MP4 -> GIF)

### Установка

```bash
python -m venv .venv

# Windows
.venv\Scripts\activate

# Linux/macOS
source .venv/bin/activate

pip install -r requirements.txt
```

### Запуск

```bash
python main.py
```

## Базовый workflow

1. В лончере нажмите `Снимок` или `Видео`.
2. Выделите область на экране.
3. Для скриншота результат откроется в редакторе.
4. Для видео выберите путь, формат (`MP4`/`GIF`) и при `GIF` при необходимости отметьте `Добавить в библиотеку мемов`.

Важно:
- Отдельного отложенного popup после сохранения GIF нет — решение о добавлении в мемы принимается сразу в диалоге сохранения.
- `Esc` отменяет захват/запись в процессе.

## Редактор

### Инструменты

- `Выделение` (`V`)
- `Лупа` (`G`) — отдельный объект сцены, можно добавлять несколько луп
- `Фигуры` (`R`/`O`) — прямоугольник/эллипс
- `Линия/Стрелка` (`L`/`A`) — одна кнопка, выбор типа через ПКМ
- `Карандаш/Маркер` (`P` + выбор через ПКМ)
- `Текст` (`T`)
- `Блюр` (`B`)
- `Ластик` (`E`)

### Анимации объектов

Через контекстное меню элемента: `Animation`.

- `Draw animation`:
  - для линий/стрелок идёт прорисовка от начала к концу;
  - цикл: активная прорисовка ~1.2с, пауза в финале ~1.5с, затем повтор.
- `Pulse`:
  - лёгкий масштаб `1.0 -> 1.05 -> 1.0`;
  - доступен только для небольших объектов.

Если на сцене есть GIF-элементы или назначены анимации объектов, сохранение по умолчанию идёт в `.gif`.

### Лупа (Zoom Lens)

- Лупа работает как обычная фигура: выделение, перемещение, масштабирование.
- Размер и кратность сохраняются в конфиге.
- Настройки лупы в верхней панели показываются только когда:
  - активен инструмент `Лупа`, или
  - выделена ровно одна лупа.
- Визуальный бейдж кратности на самой лупе убран, чтобы не шуметь интерфейс.

## GIF и библиотека мемов

- GIF из библиотеки копируется как GIF (через набор MIME-форматов), вставка в редактор приоритетно GIF-first.
- Превью GIF в библиотеке анимированные.
- Поддержаны:
  - удаление выбранных мемов;
  - переименование (контекстное меню или `F2`);
  - кнопка `Папка` / пункт `Открыть папку мемов`;
  - сохранение размеров окна библиотеки между сессиями.

## Горячие клавиши

### Глобальные

- `Ctrl+Alt+S` — запуск захвата (настраивается)

### Выделение на экране

- `ЛКМ` — начать/завершить выделение
- `Space` — переключить форму (`rect`/`ellipse`)
- `Esc` — отменить

### Редактор

- `Ctrl+N` — новый скриншот
- `Ctrl+K` — история
- `Ctrl+C` — копировать
- `Ctrl+S` — сохранить
- `Ctrl+Z` — отмена
- `Ctrl+Shift+Z` — повтор
- `Delete` — удалить выбранное
- `Ctrl` + колесо / `Ctrl` + `+` / `Ctrl` + `-` — масштаб

## Конфигурация

Файл: `~/.slipsnap_config.json`

Ключи, связанные с новыми сценариями:

- `video_duration_sec` (`5..10`)
- `video_fps` (`10..24`)
- `video_default_format` (`mp4`/`gif`)
- `video_last_save_directory`
- `meme_dialog_width`, `meme_dialog_height`
- `zoom_lens_size`, `zoom_lens_factor`

## Build With Bundled FFmpeg

1. Положите `ffmpeg.exe` в один из путей в корне проекта:
   - `ffmpeg.exe`
   - `ffmpeg/ffmpeg.exe`
   - `bin/ffmpeg.exe`
2. Соберите исполняемый файл:
   - `pyinstaller SlipSnap.spec`
3. Соберите установщик (Inno Setup):
   - `ISCC SlipSnap.iss`

Примечания:

- `SlipSnap.spec` автоматически подхватывает `ffmpeg.exe` и добавляет его в сборку.
- При запуске поиск FFmpeg идёт сначала в bundled-локациях (`sys._MEIPASS` / рядом с `.exe`), затем в `PATH`.
