# SlipSnap

Десктоп приложение на PySide6 для быстрого создания скриншотов с встроенным редактором и мгновенной отправкой в буфер обмена.

## Основные возможности

- **Захват экрана** — произвольная область или весь виртуальный рабочий стол
- **Гибкое выделение** — прямоугольник или эллипс с плавным переключением
- **Буфер обмена** — автоматическое копирование в PNG/DIB с сохранением прозрачности
- **Редактор изображений** — полный набор инструментов для аннотации и обработки
- **История снимков** — до 10 последних скриншотов с функцией создания коллажей
- **Настройка** — кастомные горячие клавиши и автосохранение параметров

## Установка и запуск

### Требования
- Python 3.8+
- PySide6

### Установка
```bash
# Создание виртуального окружения
python -m venv .venv

# Активация окружения
# Windows:
.venv\Scripts\activate
# Linux/macOS:
source .venv/bin/activate

# Установка зависимостей
pip install -r requirements.txt
```

### Запуск
```bash
python main.py
```

При первом запуске откроется компактный лончер с кнопками управления.

## Использование

### Рабочий процесс

1. **Лончер** — плавающее окно поверх всех приложений с четырьмя кнопками:
   - «Снимок» — запуск захвата экрана
   - «Квадрат/Круг» — переключение формы выделения
   - Настройка горячей клавиши
   - «Закрыть» — выход из приложения

2. **Захват области** — экран затемняется, выделенная область остаётся яркой. Результат автоматически копируется в буфер и открывается в редакторе.

3. **Редактор** — окно «SlipSnap — Редактор» с полным набором инструментов:
   - Рисование (кисть, маркер, фигуры)
   - Текстовые блоки
   - Размытие областей
   - Управление слоями
   - Экспорт и история

4. **История** — автоматическое сохранение во временную папку. Команда «История» (`Ctrl+K`) позволяет выбрать несколько снимков и объединить их в коллаж.

## Горячие клавиши

### Глобальные
| Комбинация | Действие |
|------------|----------|
| `Ctrl+Alt+S` | Запуск захвата экрана (настраивается) |

### Режим выделения
| Клавиша | Действие |
|---------|----------|
| `ЛКМ` | Начать/завершить выделение |
| `Esc` | Отменить захват |
| `Space` | Переключить форму (прямоугольник/эллипс) |

### Редактор
| Комбинация | Действие |
|------------|----------|
| `Ctrl+N` | Новый скриншот |
| `Ctrl+Shift+N` | История с добавлением коллажа |
| `Ctrl+K` | Открыть историю |
| `Ctrl+C` | Копировать в буфер |
| `Ctrl+S` | Сохранить в файл |
| `Ctrl+Z` / `Ctrl+Y` | Отмена / Повтор |
| `Delete` | Удалить выделенный элемент |
| `Ctrl` + колесо | Масштабирование |
| `Ctrl` + `+` / `-` | Масштабирование клавиатурой |

## Инструменты редактора

- **Выбор** — перемещение и редактирование объектов
- **Кисть** — свободное рисование
- **Маркер** — полупрозрачное выделение
- **Фигуры** — прямоугольники, эллипсы, линии
- **Стрелки** — направленные указатели
- **Текст** — текстовые блоки с настройкой шрифта
- **Размытие (Блюр)** — маскировка конфиденциальной информации
- **Ластик** — удаление элементов

## Архитектура проекта

### Структура файлов
```
slipsnap/
├── main.py              # Точка входа
├── gui.py               # Интерфейс (лончер, оверлеи)
├── logic.py             # Конфигурация, история, захват
├── clipboard_utils.py   # Работа с буфером обмена
└── editor/              # Модуль редактора
    ├── editor_window.py # Главное окно редактора
    ├── ui/
    │   └── canvas.py    # Канвас и инструменты
    ├── tools/           # Реализация инструментов
    └── collage.py       # Диалог истории
```

### Основные компоненты

**main.py**
- Инициализация `QApplication`
- Запуск главного контроллера `App`

**logic.py**
- Управление конфигурацией (`~/.slipsnap_config.json`)
- История снимков (временная папка `slipsnap_history`)
- Захват экрана через пакет `mss`
- Конвертация между форматами PIL и Qt

**gui.py**
- `Launcher` — компактное окно управления
- `OverlayManager` — координация оверлеев для разных мониторов
- `ScreenOverlay` / `VirtualOverlay` — затемнение и выделение области
- `App` — главный контроллер с регистрацией горячих клавиш

**clipboard_utils.py**
- Конвертация в PNG/DIB
- Кроссплатформенная работа с буфером обмена

**editor/**
- Полнофункциональный редактор изображений
- Система undo/redo
- Drag-and-drop для добавления изображений
- Создание коллажей из истории

## Конфигурация

### Настраиваемые параметры

- **Форма выделения** — `rect` или `ellipse` (кнопка в лончере или `Space`)
- **Горячая клавиша** — строка формата Qt (настраивается через лончер)
- **Толщина пера** — сохраняется между сеансами
- **Размер шрифта** — запоминается автоматически

### Хранение данных

- **Конфигурация**: `~/.slipsnap_config.json`
- **История**: `${TEMP}/slipsnap_history/shot_*.png` (автоочистка при превышении лимита)


### Зависимости

Все необходимые пакеты перечислены в `requirements.txt`:
- PySide6 — фреймворк GUI
- mss — захват экрана
- Pillow — обработка изображений
- pyqtkeybind — глобальные горячие клавиши